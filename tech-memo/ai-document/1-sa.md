# 広告メール許諾管理システム 要件定義書

| ドキュメントバージョン | 1.0 |
| :--- | :--- |
| 作成日 | 2025/07/14 |
| 作成者 | Gemini |

## 1. 概要

本システムは、ユーザーが広告配信用メールマガジンの受信を許諾（オプトイン）または停止（オプトアウト）するためのWebシステムである。ユーザー自身による簡単な操作で、メール配信設定を管理できる機能を提供する。また、管理者はユーザーの許諾状況を確認できるものとする。

-----

## 2. 用語集

本ドキュメントで使用する用語を以下のように定義する。

| 用語 | 説明 |
| :--- | :--- |
| **ユーザー** | 当社のサービスを利用する個人。メールアドレスで一意に識別される。 |
| **広告メール** | 当社からユーザーへ配信する新製品やキャンペーン情報を含む販促目的の電子メール。 |
| **オプトイン** | ユーザーが広告メールの受信を許諾すること。 |
| **オプトアウト** | ユーザーが広告メールの受信を停止すること。 |
| **許諾ステータス** | ユーザーごとの広告メール受信設定の状態。`'Opted-in'` (許諾中) または `'Opted-out'` (停止中) のいずれか。 |

-----

## 3. システム化の範囲

### 3.1. 範囲内 (In Scope)

  * ユーザーのメールアドレスを元にしたオプトイン・オプトアウト機能。
  * ユーザーが自身の許諾ステータスを確認する機能。
  * 管理者がユーザーの許諾ステータスを検索・閲覧する機能。
  * オプトイン・オプトアウト操作時にユーザーへ通知メールを送信する機能。

### 3.2. 範囲外 (Out of Scope)

  * ユーザーの会員登録・認証機能。（既存の認証基盤を利用）
  * 広告メールの文面作成・配信機能。（外部のメール配信システムと連携）
  * ユーザー情報の管理（氏名、住所など）。本システムはメールアドレスと許諾ステータスのみを管理する。

-----

## 4. 機能要件

### 4.1. ユーザー向け機能

| 機能ID | 機能名 | 機能概要 |
| :--- | :--- | :--- |
| FU-01 | **オプトイン機能** | ユーザーは、自身のメールアドレスを入力し、広告メールの受信を許諾できる。 |
| FU-02 | **オプトアウト機能** | ユーザーは、自身のメールアドレスを入力し、広告メールの受信を停止できる。 |
| FU-03 | **ステータス確認機能** | ユーザーは、自身のメールアドレスを入力し、現在の許諾ステータスを確認できる。 |

#### 4.1.1. FU-01: オプトイン機能の詳細

  * **ユーザーシナリオ**: 広告メールを受信したいユーザーとして、簡単な手続きで配信リストに登録したい。
  * **入力**:
      * メールアドレス（必須）
      * プライバシーポリシーへの同意チェック（必須）
  * **処理**:
    1.  入力されたメールアドレスの形式が正しいかチェックする。
    2.  対象のメールアドレスがシステムに存在しない場合、新規に登録し、許諾ステータスを「許諾中」に設定する。
    3.  対象のメールアドレスが既に存在する場合、許諾ステータスを「許諾中」に更新する。
    4.  処理完了後、ユーザーにオプトイン完了通知メールを送信する。
    5.  画面には「お手続きが完了しました」というメッセージを表示する。

#### 4.1.2. FU-02: オプトアウト機能の詳細

  * **ユーザーシナリオ**: 不要になった広告メールの受信を、簡単な手続きで停止したい。
  * **入力**:
      * メールアドレス（必須）
  * **処理**:
    1.  入力されたメールアドレスの形式が正しいかチェックする。
    2.  対象のメールアドレスが存在する場合、許諾ステータスを「停止中」に更新する。
    3.  対象のメールアドレスが存在しない場合、「ご入力のメールアドレスは登録されていません」というメッセージを画面に表示する。
    4.  処理完了後、ユーザーにオプトアウト完了通知メールを送信する。
    5.  画面には「配信停止手続きが完了しました」というメッセージを表示する。

-----

### 4.2. 管理者向け機能

| 機能ID | 機能名 | 機能概要 |
| :--- | :--- | :--- |
| FA-01 | **ユーザー検索機能** | 管理者は、メールアドレスでユーザーを検索し、許諾ステータスを確認できる。 |

#### 4.2.1. FA-01: ユーザー検索機能の詳細

  * **ユーザーシナリオ**: 問い合わせ対応のため、特定のユーザーの現在の許諾ステータスを迅速に確認したい。
  * **入力**:
      * 検索キーワードとしてのメールアドレス（部分一致・完全一致）
  * **出力**:
      * 検索条件に一致したユーザーのリストを表示する。
      * リストの表示項目: メールアドレス、許諾ステータス、最終更新日時。

-----

## 5. 非機能要件

| 項目 | 要件 |
| :--- | :--- |
| **パフォーマンス** | 各画面の応答時間は、操作から2秒以内に完了すること。 |
| **可用性** | システムの稼働率は99.5%以上とする。（メンテナンス時間を除く） |
| **セキュリティ** | ・ユーザーが入力する通信はすべてHTTPSで暗号化すること。\<br\>・管理者機能へのアクセスは、IPアドレス制限とパスワード認証によって保護すること。 |
| **連携** | メール配信システム（外部）がユーザーの許諾ステータスを取得できるよう、APIを提供すること。（詳細は別途API仕様書で定義） |
| **技術スタック** | ・バックエンド: Node.js (Hono)\<br\>・データベース: PostgreSQL |